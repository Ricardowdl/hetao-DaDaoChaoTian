export type CreationMode = '单机' | '联机'

export type WorldOption = {
  id: string
  名称: string
  纪元: string
  描述: string
}

export type AptitudeOption = {
  id: string
  名称: string
  点数: number
  稀有度?: number
  颜色: string
  描述: string
}

export type OriginOption = {
  id: string
  名称: string
  天赋点: number
  属性修正: Partial<Record<'根骨' | '灵性' | '悟性' | '气运' | '魅力' | '心性', number>>
  稀有度?: number
  背景效果?: Array<{ type: string; description: string }>
  描述: string
}

export type RootOption = {
  id: string
  名称: string
  品级: string
  消耗: number
  修炼速度?: string
  修炼倍率?: number
  稀有度?: number
  特殊效果?: string[]
  描述: string
}

export type TalentOption = {
  id: string
  名称: string
  消耗: number
  稀有度: number
  效果?: Array<{ 类型: string; 目标?: string; 数值: number }>
  描述: string
}

export type CreationOptionsBundle = {
  worlds: WorldOption[]
  aptitudes: AptitudeOption[]
  origins: OriginOption[]
  roots: RootOption[]
  talents: TalentOption[]
}

export type AttributeKey = '根骨' | '灵性' | '悟性' | '气运' | '魅力' | '心性'

export type WorldGenCountsDraft = {
  continentCount: number
  factionCount: number
  locationCount: number
  secretRealmsCount: number
}

export type CreationDraft = {
  模式: CreationMode
  世界: WorldOption | null
  世界规模?: WorldGenCountsDraft
  天资: AptitudeOption | null
  出身: OriginOption | null
  灵根: RootOption | null
  天赋: TalentOption[]
  先天六司: Record<AttributeKey, number>
  道号: string
  种族: string
  性别: string
  年龄: number
}

const PRESET_KEY = 'dad_creation_presets_v1'

const CUSTOM_CREATION_KEY = 'dad_custom_creation_data_v1'

function emptyBundle(): CreationOptionsBundle {
  return { worlds: [], aptitudes: [], origins: [], roots: [], talents: [] }
}

export function loadCustomCreationData(): CreationOptionsBundle {
  try {
    const raw = localStorage.getItem(CUSTOM_CREATION_KEY)
    if (!raw) return emptyBundle()
    const parsed = JSON.parse(raw) as Partial<CreationOptionsBundle>
    return {
      worlds: Array.isArray(parsed.worlds) ? (parsed.worlds as WorldOption[]) : [],
      aptitudes: Array.isArray(parsed.aptitudes) ? (parsed.aptitudes as AptitudeOption[]) : [],
      origins: Array.isArray(parsed.origins) ? (parsed.origins as OriginOption[]) : [],
      roots: Array.isArray(parsed.roots) ? (parsed.roots as RootOption[]) : [],
      talents: Array.isArray(parsed.talents) ? (parsed.talents as TalentOption[]) : []
    }
  } catch {
    return emptyBundle()
  }
}

export function saveCustomCreationData(bundle: CreationOptionsBundle) {
  localStorage.setItem(CUSTOM_CREATION_KEY, JSON.stringify(bundle))
}

export function clearCustomCreationData() {
  localStorage.removeItem(CUSTOM_CREATION_KEY)
}

export function getDefaultWorlds(): WorldOption[] {
  return [
    {
      id: 'chaotian',
      名称: '朝天大陆',
      纪元: '朝天历元年',
      描述:
        '此方世界名为"朝天大陆"，乃是一处天道完整、灵气充沛的上善之地。其核心法则是"万灵竞渡，一步登天"，无论是人、妖、精、怪，皆有缘法踏上修行之路，叩问长生。\n仙凡之别在此界泾渭分明，宛若天渊。凡人寿不过百载，受生老病死之苦，终归一抔黄土；而修士一旦踏入道途，便能吞吐天地灵气，淬炼己身，寿元动辄千载，更有大能者与天地同寿。凡俗王朝更迭，于修士而言不过是弹指一瞬间。在凡人眼中，修士是高悬于九天的仙神，一言可定一国兴衰，一念可引风雨雷霆。然而，这种力量并非毫无代价。\n此界奉行"大道争锋"的铁则，天道予万物机缘，却也降下无尽凶险。灵脉宝地、神功秘法、天材地宝，皆是有缘者居之，而"缘"字背后，往往是血与火的洗礼。修士之间，为求道途精进，争斗乃是常态。同门可能反目，挚友亦会背叛，杀人夺宝、斩草除根之事屡见不鲜。这是一个极度自由的世界，你可以选择成为守护一方的善仙，亦可成为肆虐八荒的魔头，只要你有足够的实力。但自由的背后，是无处不在的危险，一步踏错，便是万劫不复，身死道消。\n然天道亦有制衡，修士若无故以大法力干涉凡俗王朝更迭、屠戮凡人，便会与此方天地结下因果。虽无业报加身，却会在日后冲击更高境界、渡劫飞升之时，引来更强大的天劫，平添无数变数。故而多数修士选择在山门清修，或于红尘历练，以求勘破心障，证得大道。修仙百艺——炼丹、炼器、符箓、阵法，在此界发展到了极致，共同构筑了一个无比兴盛、却也无比残酷的修仙文明。'
    },
    {
      id: 'earth',
      名称: '地球',
      纪元: '灵气复苏元年',
      描述:
        '在2026年的一天，地球经历了一场前所未有的灵气复苏。曾经只存在于神话传说中的"灵气"，如潮水般涌入现代世界。科学无法解释的异象频频发生：城市上空出现极光般的能量波动，深山老林涌现出神秘的灵脉，普通动植物开始变异进化。\n在这个巨变的时代，你是极少数能感知并吸收灵气的"觉醒者"。当全世界还在用科学仪器研究这股神秘能量时，你已经能够将其炼化入体，走上了修真之路。现代化的都市、便捷的网络、发达的科技，与古老的修炼体系碰撞，产生了奇妙的化学反应。\n政府成立了"超自然事务管理局"，各国争相研究灵气应用技术，跨国企业试图将灵气商业化，而古老宗门的后裔们也纷纷出世。在这个灵气与科技并存的时代，你将在钢铁森林中独自修行，探索"科学修真"的奥秘。人类的寿命依然有限，普通人对觉醒者既敬畏又恐惧，而你，必须在两个世界之间找到自己的道路。'
    },
    {
      id: 'cyber',
      名称: '赛博修真',
      纪元: '新纪元2156',
      描述:
        '2156年，人类文明已经踏入星际时代。在赛博朋克的霓虹都市中，义体改造、神经接驳、意识上传已成为常态。然而，一次深空探索意外发现了"灵能水晶"——一种能够增强人类精神力的神秘矿石，彻底改变了世界。\n你是一名边缘跑者，在接触灵能水晶后觉醒了修炼天赋。与传统修真不同，这个时代的修行依托于"义体灵修"体系：将灵能与赛博义体结合，数据流就是灵气，神经网络就是经脉，意识核心就是丹田。你可以通过黑客手段"盗取"企业的修炼数据，可以在虚拟现实中进行"数据闭关"，也可以用纳米机器人构建"机械金丹"。\n巨型企业垄断了灵能资源，赛博修士们为了突破境界不得不接受危险任务。城市下层贫民窟中有人在破旧的胶囊旅馆里修炼，上层则是企业供养的"数据仙人"享受着无尽资源。这是一个孤独修士的时代，在霓虹闪烁、义体横行的世界里，你将用代码和灵能书写属于自己的飞升传说。'
    },
    {
      id: 'magic',
      名称: '魔法纪元',
      纪元: '第七魔法时代',
      描述:
        '这是一个魔法与灵气融合的奇幻世界。千年前，东方的"修真体系"与西方的"魔法体系"发生了史诗级的碰撞，最终两大文明达成了微妙的平衡。在这个世界，古老的修真宗门与魔法学院并存，道家的符箓与炼金术的魔法阵有着惊人的相似之处。\n你生于边境之地，这里是两大文明的交汇点。你可以选择传统的修真之路，炼气筑基金丹元婴；也可以学习西方的魔法体系，成为元素法师或是死灵术士。更有野心者，试图融合两种体系，创造前所未有的"魔修"之道。\n这个世界充满了机遇与危险。古老的龙族盘踞在灵脉之上，精灵王国守护着世界树的秘密，矮人在地底挖掘着魔晶矿脉，而人类帝国则在两大体系的碰撞中寻找平衡。魔法学院的学生可能会与修真宗门的弟子发生冲突，古老的修士可能需要面对掌握禁咒的大魔法师。在这个融合与冲突并存的时代，你将独自探索两种力量的奥秘，寻找超越极限的可能。'
    },
    {
      id: 'honghuang',
      名称: '洪荒末世',
      纪元: '末法时代第三千纪',
      描述:
        '这是一个力量体系凋零的末世。远古时期，神魔横行，大能者手掌星辰、脚踏虚空。然而，随着一场席卷整个大陆的"天道浩劫"，灵气逐渐枯竭，曾经无敌的修真体系已经支离破碎。如今的世界，已是末法时代的第三千年。\n你生于这个衰败的时代，灵脉枯竭、天材地宝近乎绝迹。曾经辉煌的仙门大多已成废墟，唯有少数传承尚存，苟延残喘。修行之路艰难无比，炼气都需要数十年苦功。但正因如此，这是一个回归本真的时代——没有捷径，没有外丹，只有最朴素的苦修和磨砺。\n末法时代的残酷在于，每一次突破都可能是生死劫。资源稀缺，强者为了一株灵草可以血洗一座城。时间在这里变得更加沉重，修士闭关数十年醒来，可能发现整个宗门已经覆灭。这是一个适者生存的时代，也是最考验道心的时代。'
    },
    {
      id: 'starsea',
      名称: '星海修仙',
      纪元: '星际大航海时代',
      描述:
        '修真文明已经突破了星球的束缚，踏入无垠星海。数万年前，第一批渡劫期大能飞升失败，却意外发现了宇宙深处的无数修真星球，开启了星际大航海时代。\n在这个宇宙中，每颗星球都有独特的修真体系和力量源泉。有的星球灵气浓郁如海，有的星球则孕育着特殊的"星辰之力"。修士们驾驭飞舟穿梭星海，探索遗迹，争夺资源。星际势力林立，古老的修真宗门演变成跨星系的修真帝国。\n这里的时间跨度更加恐怖。炼虚期修士闭关百年，可能醒来时已经跨越了数光年。星际航行动辄数十年，修士们在飞舟中修炼、突破、衰老。有人耗尽千年寿元，也无法到达传说中的"道源星"。这是一个孤独的时代，星海茫茫，道路漫长，而时间是最无情的敌人。'
    },
    {
      id: 'martial',
      名称: '武道苍穹',
      纪元: '武道纪元',
      描述:
        '这是一个以武入道的世界，没有传统的灵气修炼，只有纯粹的武道体系。在这里，力量来源于对身体的极致淬炼和对武道真意的感悟。拳破山河、掌碎虚空，是武者的终极追求。\n武道修行分为淬体、凝气、通玄、化真、破虚、登天六大境界。每一次突破都需要经历生死磨砺，没有丹药捷径，只有血与汗的浇灌。淬体期需要十年打熬筋骨，凝气期需要三十年凝练真气，通玄期需要百年感悟武道真意。\n这个世界同样遵循时间的残酷法则。武者闭关苦修，出关时故人已老。高阶武者一次生死战，可能就是数十年寿命的代价。武道宗门的兴衰更迭，不过是百年一瞬。这里没有长生之道，只有燃烧生命追求武道极致的修罗之路。'
    },
    {
      id: 'weird',
      名称: '诡异世界',
      纪元: '混沌纪元',
      描述:
        '这是一个被诡异力量侵蚀的扭曲世界。正常的修真体系已经崩坏，取而代之的是融合了诡异之力的"畸变修行"。修士们不再单纯追求境界突破，而是在保持理智与获得力量之间走钢丝。\n诡异之力无处不在，污染着灵脉、腐蚀着功法、扭曲着生灵。传统的修真路已经走不通，修士们必须学会与诡异共存，甚至主动融合诡异之力。但这条路充满代价——每一次力量提升，都伴随着理智的削弱和身体的异化。\n时间在这里变得更加压迫。诡异侵蚀不会停止，修士们必须在完全疯狂前突破到更高境界。有人闭关十年，出来时已经异化成怪物。有人苦修百年，终于登顶，却发现自己已经失去了人性。这是一个绝望的时代，也是最考验意志的修行之路。'
    },
    {
      id: 'douluo',
      名称: '斗罗大陆',
      纪元: '魂师纪元',
      描述:
        '这是一个以武魂为核心的奇幻世界。在这里，每个人都拥有与生俱来的武魂——有的是器武魂如昊天锤、七杀剑，有的是兽武魂如蓝银草、邪眸白虎。武魂的强弱决定了一个人的起点，但真正的强者还需要通过猎杀魂兽，吸收魂环来提升实力。\n\n斗罗大陆的力量体系分为魂师、魂尊、魂宗、魂王、魂帝、魂圣、魂斗罗、封号斗罗九大等级，每提升十级需要吸收一枚魂环。魂环分为十年、百年、千年、万年、十万年五种，魂环年限越高，提供的魂技越强大。但吸收过强的魂环也可能导致身体爆体而亡。\n\n在这个世界，武魂殿统治着整个大陆，两大帝国天斗与星罗分庭抗礼，各大宗门如昊天宗、七宝琉璃宗等暗流涌动。魂师是这个世界最尊贵的职业，但成为强者的道路充满凶险——每一次猎杀魂兽都是生死搏斗，每一次吸收魂环都可能走火入魔。\n\n时间在这里同样残酷。封号斗罗寿命不过三百年，而要从普通魂师修炼到封号斗罗，至少需要数十年甚至百年苦修。魂兽森林深处危机四伏，十万年魂兽更是可以化形为人，拥有不逊于封号斗罗的实力。这是一个天才辈出的时代，也是一个弱肉强食的修罗场。'
    },
    {
      id: 'night',
      名称: '夜的命名术',
      纪元: '联邦历776年',
      描述:
        '这是一个被联邦高墙所圈禁的赛博朋克世界。巨型城市在永恒的黑夜与霓虹中呼吸，机械神明在数据网络中俯瞰众生，基因锁链是每个人与生俱来的枷锁。你是在这座囚笼中长大的普通人，直到某一天，你意外觉醒了超凡序列的力量。\n\n在这里，力量意味着一切。财阀、帮派、雇佣兵、觉醒者……无数势力在城市的阴影中盘根错节。为了打破基因的束缚，为了在残酷的法则下活下去，你必须不断战斗、进化，攀登超凡序列的阶梯。\n\n这是一个没有退路的世界。每一次选择都可能通向死亡，每一次战斗都是在与命运豪赌。你将独自面对这个充满压迫与机遇的赛博世界，探索禁忌之地的秘密，成为食物链的顶端，或者，被时代的洪流彻底吞噬。'
    }
  ]
}

export function getDefaultAptitudes(): AptitudeOption[] {
  return [
    { id: 'a10', 名称: '废柴', 点数: 10, 颜色: '#808080', 描述: '资质平平，毫无出奇之处，仙路渺茫。' },
    { id: 'a20', 名称: '凡人', 点数: 20, 颜色: '#FFFFFF', 描述: '芸芸众生中的一员，不好不坏，有缘可入仙途。' },
    { id: 'a30', 名称: '俊杰', 点数: 30, 颜色: '#4169E1', 描述: '百里挑一的人才，略有不凡，在宗门中可为内门弟子。' },
    { id: 'a40', 名称: '天骄', 点数: 40, 颜色: '#9932CC', 描述: '千年难遇的奇才，注定耀眼，是宗门未来的希望。' },
    { id: 'a50', 名称: '妖孽', 点数: 50, 颜色: '#FFD700', 描述: '万古无一的怪物，逆天而行，可与上古神魔比肩。' },
    { id: 'a60', 名称: '谪仙转世', 点数: 60, 颜色: '#FF4500', 描述: '仙人转世，天生道胎，记忆蒙尘但灵性不昧，修行一日千里。' },
    { id: 'a70', 名称: '大道之子', 点数: 70, 颜色: '#DAA520', 描述: '大道化身，天生与道相合，万法皆通，是此纪元的应劫之人。' }
  ]
}

export function getDefaultOrigins(): OriginOption[] {
  return [
    { id: 'o0', 名称: '山野遗孤', 天赋点: 0, 属性修正: { 根骨: 1 }, 描述: '自幼在山野中长大，与猛兽为伴，磨练出坚韧的意志和过人的体魄。' },
    { id: 'o1', 名称: '书香门第', 天赋点: 2, 属性修正: { 悟性: 2 }, 描述: '出身于官宦世家，饱读诗书，对天地至理有超乎常人的理解力。' },
    { id: 'o2', 名称: '商贾之子', 天赋点: 2, 属性修正: { 魅力: 2 }, 描述: '生于富贵之家，精通人情世故，处事圆滑，魅力非凡。' },
    { id: 'o3', 名称: '将门之后', 天赋点: 3, 属性修正: { 心性: 2, 根骨: 1 }, 描述: '名将的后代，血脉中流淌着勇武与煞气，心性坚定。' },
    { id: 'o5', 名称: '散修传人', 天赋点: 4, 属性修正: { 悟性: 1, 心性: 1 }, 描述: '你的师父是一位游戏风尘的强大散修，你继承了他的部分衣钵和见识。' },
    { id: 'o6', 名称: '魔道卧底', 天赋点: 1, 属性修正: { 心性: 3 }, 描述: '你出身名门正派，却被派往魔道执行卧底任务，心性远超常人。' },
    { id: 'o7', 名称: '重生者', 天赋点: 5, 属性修正: { 悟性: 2, 气运: 1 }, 描述: '你保留着前世的记忆，虽然修为尽失，但对功法和未来的大事了如指掌。' },
    { id: 'o8', 名称: '仙人后裔', 天赋点: 6, 属性修正: { 灵性: 2, 根骨: 1 }, 描述: '你的血脉中流淌着稀薄的仙人之血，天生灵性十足，修炼速度略快于常人。' },
    { id: 'o9', 名称: '夺舍老怪', 天赋点: 7, 属性修正: { 悟性: 3, 心性: -1 }, 描述: '你是一名夺舍重生的老怪物，虽然占据了年轻的肉体，但灵魂中蕴含着庞大的神识力量。' },
    { id: 'o10', 名称: '山神庙祝', 天赋点: 2, 属性修正: { 灵性: 2 }, 描述: '你从小在山神庙长大，日夜与香火为伴，神魂受到滋养，对鬼神之事有特殊感应。' },
    { id: 'o4', 名称: '渔家少年', 天赋点: 1, 属性修正: { 根骨: 2 }, 描述: '常年在江河湖海中讨生活，水性极佳，体魄强健。' },
    { id: 'o11', 名称: '王朝皇子', 天赋点: 3, 属性修正: { 魅力: 2, 心性: 1 }, 描述: '生于凡人王朝的权力之巅，自幼享受锦衣玉食和最好的教育，但与修仙界的接触较少。' },
    { id: 'o12', 名称: '药童出身', 天赋点: 2, 属性修正: { 灵性: 1, 悟性: 1 }, 描述: '自幼在丹房长大，日夜与灵药为伴，对药理有超常的敏感。' },
    { id: 'o13', 名称: '阵法学徒', 天赋点: 3, 属性修正: { 悟性: 2, 灵性: 1 }, 描述: '师从阵法大师，自小研习阵法纹路，对空间感知极其敏锐。' },
    { id: 'o14', 名称: '猎妖世家', 天赋点: 4, 属性修正: { 根骨: 2, 心性: 1 }, 描述: '祖上世代以猎妖为生，血脉中蕴含微弱的妖族之力，对妖气极其敏感。' },
    { id: 'o15', 名称: '流浪乞丐', 天赋点: -1, 属性修正: { 心性: 2, 气运: -1 }, 描述: '自幼流落街头，饱经风霜，磨练出超凡的意志和适应能力。' },
    { id: 'o16', 名称: '矿奴余生', 天赋点: 0, 属性修正: { 根骨: 3, 灵性: -1 }, 描述: '曾是灵矿奴隶，在暗无天日的矿洞中挣扎求生，体魄强健但缺乏灵性。' },
    { id: 'o17', 名称: '画师传人', 天赋点: 3, 属性修正: { 悟性: 1, 魅力: 2 }, 描述: '师承名家，精通丹青之道，对符箓有天生的理解力。' },
    { id: 'o18', 名称: '古墓守陵人', 天赋点: 2, 属性修正: { 心性: 2, 灵性: 1 }, 描述: '世代守护古墓，长期与死气阴气打交道，对鬼道有独特感悟。' },
    { id: 'o19', 名称: '戏班伶人', 天赋点: 1, 属性修正: { 魅力: 3, 心性: -1 }, 描述: '自幼学戏，擅长察言观色，魅力非凡，但修道之心不够坚定。' },
    { id: 'o20', 名称: '星象世家', 天赋点: 5, 属性修正: { 悟性: 2, 气运: 2 }, 描述: '家族世代观星测运，你自小研习星象之术，对天地规律有独特理解。' },
    { id: 'o21', 名称: '部落萨满', 天赋点: 4, 属性修正: { 灵性: 2, 根骨: 1 }, 描述: '出身蛮荒部落，继承了萨满的血脉，对自然之力有天生的亲和。' },
    { id: 'o22', 名称: '孤岛遗民', 天赋点: 3, 属性修正: { 心性: 2, 悟性: 1 }, 描述: '生于与世隔绝的孤岛，保留着上古时代的原始修行法门。' },
    { id: 'o23', 名称: '亡国遗孤', 天赋点: 2, 属性修正: { 心性: 3, 气运: -1 }, 描述: '国破家亡，历经苦难，心性坚韧如铁，但背负着沉重的仇恨。' }
  ]
}

export function getDefaultRoots(): RootOption[] {
  return [
    { id: 'r_rand', 名称: '随机灵根', 品级: '未知', 消耗: 0, 描述: '听天由命。' },
    {
      id: 'r_jin_up',
      名称: '金灵根',
      品级: '上品',
      消耗: 10,
      修炼倍率: 1.6,
      修炼速度: '1.6x',
      特殊效果: ['金系法术威力+50%', '器物亲和+30%', '金属感知'],
      描述: '金曰从革，操控金铁，锋锐无匹。修行金系功法事半功倍，是天生的剑修或刀客胚子，攻击性极强。'
    },
    {
      id: 'r_mu_up',
      名称: '木灵根',
      品级: '上品',
      消耗: 10,
      修炼倍率: 1.6,
      修炼速度: '1.6x',
      特殊效果: ['木系法术威力+50%', '生命力恢复+40%', '植物沟通'],
      描述: '木曰曲直，亲和草木，生机盎然。修行木系功法极快，擅长治疗、控制，且对灵植有天生的亲和力。'
    },
    {
      id: 'r_shui_up',
      名称: '水灵根',
      品级: '上品',
      消耗: 10,
      修炼倍率: 1.6,
      修炼速度: '1.6x',
      特殊效果: ['水系法术威力+50%', '灵气恢复+40%', '水体感知'],
      描述: '水曰润下，御水之脉，绵延不绝。修行水系功法，法力悠长，变化多端，适应性极强。'
    },
    {
      id: 'r_huo_up',
      名称: '火灵根',
      品级: '上品',
      消耗: 10,
      修炼倍率: 1.6,
      修炼速度: '1.6x',
      特殊效果: ['火系法术威力+50%', '爆发伤害+60%', '火焰免疫'],
      描述: '火曰炎上，天生火脉，焚尽八荒。修行火系功法，威力绝伦，爆发力强，是炼丹师的绝佳天赋。'
    },
    {
      id: 'r_tu_up',
      名称: '土灵根',
      品级: '上品',
      消耗: 10,
      修炼倍率: 1.6,
      修炼速度: '1.6x',
      特殊效果: ['土系法术威力+50%', '防御力+40%', '大地感知'],
      描述: '土爰稼穑，大地之子，厚德载物。修行土系功法，防御惊人，稳如泰山，是天生的阵法师材料。'
    },
    {
      id: 'r_lei',
      名称: '雷灵根',
      品级: '极品',
      消耗: 15,
      修炼倍率: 2.0,
      修炼速度: '2.0x',
      特殊效果: ['雷系法术威力+80%', '雷霆免疫', '速度+50%', '穿透攻击'],
      描述: '万中无一的变异灵根，天生雷体，雷霆万钧。修行雷系功法速度极快，威力绝伦，是天劫的宠儿。'
    },
    {
      id: 'r_bing',
      名称: '冰灵根',
      品级: '极品',
      消耗: 15,
      修炼倍率: 2.0,
      修炼速度: '2.0x',
      特殊效果: ['冰系法术威力+80%', '减速效果+100%', '冰霜免疫', '空间冻结'],
      描述: '极为罕见的变异灵根，冰霜之躯，万物凋零。修行冰系功法，控制力超凡，能冰封千里。'
    },
    {
      id: 'r_an',
      名称: '暗灵根',
      品级: '极品',
      消耗: 15,
      修炼倍率: 2.0,
      修炼速度: '2.0x',
      特殊效果: ['暗系法术威力+80%', '隐身能力', '暗夜增幅+50%', '影遁'],
      描述: '极为罕见的变异灵根，与黑暗为伴，掌控阴影之力。修行暗系功法速度极快，擅长隐匿和暗杀。'
    },
    {
      id: 'r_guang',
      名称: '光灵根',
      品级: '极品',
      消耗: 15,
      修炼倍率: 2.0,
      修炼速度: '2.0x',
      特殊效果: ['光系法术威力+80%', '邪祟克制+100%', '治愈增幅', '圣光庇护'],
      描述: '传说中的圣洁灵根，天生亲近光明，驱邪破煞。修行光系功法事半功倍，对邪祟有天然克制。'
    },
    {
      id: 'r_du',
      名称: '毒灵根',
      品级: '极品',
      消耗: 15,
      修炼倍率: 2.0,
      修炼速度: '2.0x',
      特殊效果: ['毒系法术威力+80%', '百毒不侵', '剧毒增幅', '毒素感知'],
      描述: '极为罕见的变异灵根，天生百毒不侵，修行毒功速度极快，是毒道修士梦寐以求的体质。'
    },
    {
      id: 'r_wuxing',
      名称: '五行杂灵根',
      品级: '凡品',
      消耗: 0,
      修炼倍率: 1.0,
      修炼速度: '1.0x',
      特殊效果: ['平凡之道', '大器晚成'],
      描述: '五行皆有，却驳杂不堪。'
    },
    {
      id: 'r_feng',
      名称: '风灵根',
      品级: '下品',
      消耗: 3,
      修炼倍率: 1.1,
      修炼速度: '1.1x',
      特殊效果: ['风系法术威力+15%', '移动速度+20%'],
      描述: '微风轻抚，灵活多变。'
    },
    {
      id: 'r_xueling',
      名称: '血灵根',
      品级: '特殊',
      消耗: 10,
      修炼倍率: 1.8,
      修炼速度: '1.8x',
      特殊效果: ['血系法术威力+70%', '吸血恢复', '嗜血狂化', '魔道亲和'],
      描述: '邪道灵根，以血为引，修行迅速但需要大量鲜血滋养。容易走火入魔，但力量增长极快。'
    },
    {
      id: 'r_guling',
      名称: '骨灵根',
      品级: '特殊',
      消耗: 8,
      修炼倍率: 1.7,
      修炼速度: '1.7x',
      特殊效果: ['死灵法术威力+60%', '骸骨操控', '死气免疫', '鬼道天赋'],
      描述: '罕见的死灵根，天生亲近死气，能够操控骸骨。修行鬼道功法速度极快，但被正道所不容。'
    },
    {
      id: 'r_dual',
      名称: '双生灵根',
      品级: '极品',
      消耗: 14,
      修炼倍率: 1.8,
      修炼速度: '1.8x',
      特殊效果: ['双系法术亲和', '融合突破+30%', '双修加成'],
      描述: '双系法术亲和，融合突破。'
    },
    {
      id: 'r_hundun',
      名称: '混沌灵根',
      品级: '神品',
      消耗: 25,
      修炼倍率: 2.8,
      修炼速度: '0.8x(前期) → 2.8x(后期)',
      特殊效果: ['全系法术亲和', '无属性限制', '越阶战斗+50%', '突破概率+30%'],
      描述: '传说中的至高灵根，万法归一，包容万象。可修行所有属性功法，无瓶颈，但初期进展缓慢，后期一日千里。'
    },
    {
      id: 'r_xukong',
      名称: '虚空灵根',
      品级: '神品',
      消耗: 25,
      修炼倍率: 3.0,
      修炼速度: '0.9x(前期) → 3.0x(后期)',
      特殊效果: ['空间法术精通', '虚空穿梭', '空间锁定', '次元斩'],
      描述: '传说中的至高灵根之一，掌控虚空法则，可穿梭空间。修行极难但潜力无穷。'
    },
    {
      id: 'r_time',
      名称: '时间灵根',
      品级: '神品',
      消耗: 28,
      修炼倍率: 3.2,
      修炼速度: '0.8x(前期) → 3.2x(后期)',
      特殊效果: ['时间法术精通', '时光倒流', '因果推演', '时间加速'],
      描述: '最为稀有的传说灵根，触及时间法则。修炼艰难但一旦有成，可逆转岁月，掌控因果。'
    },
    {
      id: 'r_star',
      名称: '星辰灵根',
      品级: '神品',
      消耗: 26,
      修炼倍率: 2.9,
      修炼速度: '0.85x(前期) → 2.9x(后期)',
      特殊效果: ['星辰之力', '星图演化', '星光庇护', '星陨术'],
      描述: '吸纳星辰之力的稀世灵根，与星空共鸣。修行缓慢但境界稳固，可借星辰之力突破瓶颈。'
    },
    {
      id: 'r_yinyang',
      名称: '阴阳灵根',
      品级: '神品',
      消耗: 27,
      修炼倍率: 3.1,
      修炼速度: '0.9x(前期) → 3.1x(后期)',
      特殊效果: ['阴阳调和', '两仪归一', '太极生威', '阴阳逆转'],
      描述: '至高双生灵根，阴阳调和，太极生两仪。可同时修炼阴阳两种功法，融合后威力倍增。'
    },
    {
      id: 'r_tiandu',
      名称: '天妒之体',
      品级: '特殊',
      消耗: -5,
      修炼倍率: 0.5,
      修炼速度: '0.5x',
      特殊效果: ['根基极其稳固', '突破后实力暴增+100%', '天劫抗性+80%', '逆天改命'],
      描述: '天道所妒，灵气不亲。修行速度极为缓慢，常人难以忍受。但一旦突破，根基无比扎实，战力远超同阶。'
    }
  ]
}

export function getDefaultTalents(): TalentOption[] {
  return [
    { id: 't_hero', 名称: '天命主角', 消耗: 15, 稀有度: 5, 描述: '气运惊人，总是能在绝境中逢生，获得意想不到的机缘。' },
    { id: 't_sword', 名称: '剑道独尊', 消耗: 12, 稀有度: 5, 描述: '天生剑心通明，任何剑法一看便会，且威力倍增。' },
    { id: 't_dan', 名称: '丹道圣手', 消耗: 12, 稀有度: 5, 描述: '对药理有超凡的领悟力，炼丹成功率与品质大幅提升。' },
    { id: 't_array', 名称: '阵法大师', 消耗: 8, 稀有度: 4, 描述: '对阵法有极高的天赋，学习和布置阵法的效率大大提高。' },
    { id: 't_forge', 名称: '炼器鬼才', 消耗: 8, 稀有度: 4, 描述: '天生对各种材料有敏锐的感知，炼器时更容易出现极品。' },
    { id: 't_treasure', 名称: '多宝童子', 消耗: 7, 稀有度: 4, 描述: '出门历练时，更容易发现天材地宝。' },
    { id: 't_body', 名称: '体修奇才', 消耗: 5, 稀有度: 3, 描述: '肉身天生强横，气血旺盛，适合修炼体修功法。' },
    { id: 't_memory', 名称: '过目不忘', 消耗: 2, 稀有度: 2, 描述: '记忆力超群，学习功法秘籍速度加快。' },
    { id: 't_charm', 名称: '顶级魅力', 消耗: 8, 稀有度: 4, 描述: '天生丽质，气质非凡，魅力超群。无论走到哪里都是众人瞩目的焦点，极容易获得他人的好感与信任。在社交场合如鱼得水，能够以言语和魅力化解大部分冲突。' },
    { id: 't_heart', 名称: '道心坚固', 消耗: 6, 稀有度: 4, 描述: '道心如铁，心魔难侵。突破时更不容易走火入魔，受到诱惑和幻术影响的几率大幅降低。' },
    { id: 't_heaven', 名称: '天道眷顾', 消耗: 10, 稀有度: 5, 描述: '受天道眷顾，突破时成功率更高，遭遇天劫时威力减弱。' },
    { id: 't_jianbone', 名称: '剑骨天成', 消耗: 10, 稀有度: 5, 描述: '天生剑骨，与剑有莫名的契合。剑法威力倍增，领悟剑意速度极快。' },
    { id: 't_body2', 名称: '天生道体', 消耗: 18, 稀有度: 5, 描述: '传说中的道体，天生契合天地大道，修炼任何功法都事半功倍。' },
    { id: 't_fu', 名称: '符道奇才', 消耗: 7, 稀有度: 4, 描述: '对符箓有超凡的领悟，绘制符箓成功率高，威力强大。' },
    { id: 't_dream', 名称: '先知梦境', 消耗: 8, 稀有度: 5, 描述: '偶尔能在梦中窥见未来的片段，提前规避危险或把握机缘。' },
    { id: 't_lonestar', 名称: '孤星命格', 消耗: -3, 稀有度: 3, 描述: '天煞孤星，注定孤独一生。气运极低，但在绝境中更容易突破。' }
  ]
}

export function createEmptyDraft(mode: CreationMode): CreationDraft {
  return {
    模式: mode,
    世界: null,
    世界规模: {
      continentCount: 4,
      factionCount: 5,
      locationCount: 12,
      secretRealmsCount: 5
    },
    天资: null,
    出身: null,
    灵根: null,
    天赋: [],
    先天六司: { 根骨: 0, 灵性: 0, 悟性: 0, 气运: 0, 魅力: 0, 心性: 0 },
    道号: '',
    种族: '人族',
    性别: '男',
    年龄: 16
  }
}

export function loadPresets(): Record<string, CreationDraft> {
  try {
    const raw = localStorage.getItem(PRESET_KEY)
    if (!raw) return {}
    const parsed = JSON.parse(raw) as Record<string, CreationDraft>
    return parsed || {}
  } catch {
    return {}
  }
}

export function savePreset(name: string, draft: CreationDraft) {
  const presets = loadPresets()
  presets[name] = JSON.parse(JSON.stringify(draft)) as CreationDraft
  localStorage.setItem(PRESET_KEY, JSON.stringify(presets))
}

export function deletePreset(name: string) {
  const presets = loadPresets()
  delete presets[name]
  localStorage.setItem(PRESET_KEY, JSON.stringify(presets))
}

export async function fetchJson<T>(url: string, init?: RequestInit): Promise<T> {
  const res = await fetch(url, init)
  if (!res.ok) {
    throw new Error(`Request failed: ${res.status}`)
  }
  return (await res.json()) as T
}

export async function tryFetchCreationOptions(baseUrl: string) {
  const normalized = baseUrl.replace(/\/+$/, '')
  const [worlds, aptitudes, origins, roots, talents] = await Promise.all([
    fetchJson<WorldOption[]>(`${normalized}/api/v1/worlds/`).catch(() => null),
    fetchJson<AptitudeOption[]>(`${normalized}/api/v1/aptitudes/`).catch(() => null),
    fetchJson<OriginOption[]>(`${normalized}/api/v1/origins/`).catch(() => null),
    fetchJson<RootOption[]>(`${normalized}/api/v1/spirit_roots/`).catch(() => null),
    fetchJson<TalentOption[]>(`${normalized}/api/v1/talents/`).catch(() => null)
  ])

  return {
    worlds,
    aptitudes,
    origins,
    roots,
    talents
  }
}
